<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jakarta Time & Hijri Calendar</title>
  <style>
    /* RESET & LAYOUT */
    * { box-sizing:border-box; margin:0; padding:0 }
    html,body { height:100% }
    body {
      position:relative;
      overflow-x:hidden;
      overflow-y:auto;
      font-family:sans-serif;
      display:flex; align-items:center; justify-content:center;
      transition: background 1s ease-in-out;
      background-size:cover; background-position:center;
      background-image:url('/static/images/day.jpg');
      padding:clamp(1rem, 3vw, 2rem);
      padding-bottom:calc(clamp(1rem,4vh,3.5rem) + env(safe-area-inset-bottom, 0));
      min-height:100vh;
    }

    /* SKY LAYERS */
    .layer {
      position:absolute; inset:0;
      background-repeat:repeat;
      opacity:0; pointer-events:none;
      transition:opacity 1s ease-in-out;
    }
    #stars  { background-image:url('/static/images/stars.png'); animation:star-drift 200s linear infinite; z-index:3 }
    #noon   { background:linear-gradient(to bottom,#FF9E2C,#FFD76D); z-index:1 }
    #dusk   { background:linear-gradient(to bottom,rgba(255,94,0,0.2),rgba(128,0,128,0.2)); z-index:2 }
    #clouds {
      background-image:url('/static/images/clouds.png');
      animation:cloud-drift 60s linear infinite;
      z-index:5;
      top:0; bottom:auto; height:45%;
    }

    /* SUN & MOON */
    .celestial {
      position:absolute; width:120px; height:120px;
      background-size:contain; background-repeat:no-repeat;
      display:none; pointer-events:none; z-index:4;
    }
    #sun  { background-image:url('/static/images/sun.png') }
    #moon { background-image:url('/static/images/moon.png') }

    /* LAYER VISIBILITY */
    body.noon   #noon   { opacity:1 }
    body.day    #noon   { opacity:0 }
    body.night  #noon   { opacity:0 }

    body.noon   #dusk   { /* JS‐controlled */ }
    body.day    #dusk   { /* JS‐controlled */ }
    body.night  #dusk   { opacity:0 }

    body.noon   #stars  { opacity:0.3 }
    body.day    #stars  { opacity:0 }
    body.night  #stars  { opacity:1 }

    body.noon   #clouds { opacity:0.7 }
    body.day    #clouds { opacity:0.7 }
    body.night  #clouds { opacity:0.7 }

    /* Celestial show/hide */
    body.day    #sun,    body.noon #sun   { display:block }
    body.day    #moon,   body.noon #moon  { display:none }
    body.night  #sun                    { display:none }
    body.night  #moon                   { display:block }

    /* CLOCK */
    .clock-wrapper {
      position:relative;
      z-index:6;
      width:min(86vmin, 520px);
      aspect-ratio:1;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:1.5rem;
    }
    .clock-face {
      position:relative;
      width:100%;
      height:100%;
      border-radius:50%;
      background:#f5f5f5;
      box-shadow:0 20px 35px rgba(0,0,0,0.35);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .clock-ring {
      position:absolute;
      inset:6%;
      border-radius:50%;
      background:#e2e2e2;
      box-shadow:inset 0 0 0 12px #fff;
    }
    .clock-center {
      position:absolute;
      inset:28%;
      border-radius:50%;
      background:#fff;
      box-shadow:0 6px 12px rgba(0,0,0,0.15);
      z-index:1;
    }
    .clock-ticks {
      position:absolute;
      inset:0;
      z-index:2;
    }
    .clock-ticks .tick {
      position:absolute;
      top:50%;
      left:50%;
      width:4px;
      height:16px;
      background:#222;
      transform:rotate(var(--tick-rotate)) translateY(-45%);
      transform-origin:center center;
      border-radius:2px;
    }
    .hand {
      position:absolute;
      top:50%;
      left:50%;
      transform-origin:50% 100%;
      border-radius:50px;
      z-index:3;
    }
    .hand.hour {
      width:8px;
      height:20%;
      background:#111;
    }
    .hand.minute {
      width:6px;
      height:30%;
      background:#111;
    }
    .hand.second {
      width:2px;
      height:34%;
      background:#e33636;
    }
    .center-cap {
      position:absolute;
      width:12px;
      height:12px;
      border-radius:50%;
      background:#111;
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      z-index:4;
    }
    .clock-labels {
      text-align:center;
      color:#1c1c1c;
      font-size:clamp(0.9rem, 2.4vmin, 1.2rem);
      display:flex;
      flex-direction:column;
      gap:0.4rem;
      font-family:serif;
    }
    .clock-labels span {
      display:block;
      color:#1c1c1c;
    }

    /* KEYFRAMES */
    @keyframes star-drift  { 0%{background-position:0 0} 100%{background-position:-1000px 0} }
    @keyframes cloud-drift { 0%{background-position:0 0} 100%{background-position:-800px 0} }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      body {
        padding:1rem;
      }
      .clock-wrapper {
        width:min(90vmin, 420px);
      }
      .clock-labels {
        font-size:clamp(0.85rem, 3.2vmin, 1.1rem);
      }
    }
  </style>
</head>
<body>
  <!-- SKY LAYERS -->
  <div id="stars"  class="layer"></div>
  <div id="noon"   class="layer"></div>
  <div id="dusk"   class="layer"></div>
  <div id="clouds" class="layer"></div>

  <!-- SUN & MOON -->
  <div id="sun"   class="celestial"></div>
  <div id="moon"  class="celestial"></div>

  <!-- CLOCK -->
  <div class="clock-wrapper">
    <div class="clock-face">
      <div class="clock-ring"></div>
      <div class="clock-center"></div>
      <div id="clock-ticks" class="clock-ticks"></div>
      <div id="hour-hand" class="hand hour"></div>
      <div id="minute-hand" class="hand minute"></div>
      <div id="second-hand" class="hand second"></div>
      <div class="center-cap"></div>
    </div>
    <div class="clock-labels">
      <div id="hijri-date">*Hijr date</div>
      <div id="gregorian-date">*Gregorian date</div>
    </div>
  </div>

  <script>
    const ZONE   = 'Asia/Jakarta';
    const sunEl  = document.getElementById('sun');
    const moonEl = document.getElementById('moon');
    const duskEl = document.getElementById('dusk');

    // Arc control points flipped: sunrise on right, sunset on left
    const A = { x:75, top:14 }, B = { x:86, top:4 }, C = { x:97, top:14 };
    const lerp = (a,b,t) => a + (b-a)*t;

    // Hijri always in English + Umm al-Qura
    const hijriLocale = 'en-GB-u-ca-islamic-umalqura';

    function buildTicks() {
      const ticks = document.getElementById('clock-ticks');
      for (let i = 0; i < 12; i += 1) {
        const tick = document.createElement('div');
        tick.className = 'tick';
        tick.style.setProperty('--tick-rotate', `${i * 30}deg`);
        ticks.appendChild(tick);
      }
    }

    function updateClock(now) {
      const dateOpts = { year:'numeric', month:'2-digit', day:'2-digit', timeZone:ZONE };
      const timeOpts = { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:ZONE };
      const parts = new Intl.DateTimeFormat('en-GB', timeOpts).formatToParts(now);
      const hour = +parts.find(p=>p.type==='hour').value;
      const minute = +parts.find(p=>p.type==='minute').value;
      const second = +parts.find(p=>p.type==='second').value;

      const hourAngle = ((hour % 12) + minute / 60) * 30;
      const minuteAngle = (minute + second / 60) * 6;
      const secondAngle = second * 6;

      document.getElementById('hour-hand').style.transform =
        `translate(-50%, -100%) rotate(${hourAngle}deg)`;
      document.getElementById('minute-hand').style.transform =
        `translate(-50%, -100%) rotate(${minuteAngle}deg)`;
      document.getElementById('second-hand').style.transform =
        `translate(-50%, -100%) rotate(${secondAngle}deg)`;

      const hijriOffsetMinutes = 17 * 60 + 59;
      const totalMinutes = hour * 60 + minute;
      const hijriBase = totalMinutes >= hijriOffsetMinutes
        ? now
        : new Date(now.getTime() - 86400e3);

      document.getElementById('gregorian-date').textContent =
        `*${new Intl.DateTimeFormat('en-GB', dateOpts).format(now)}`;
      document.getElementById('hijri-date').textContent =
        `*${new Intl.DateTimeFormat(hijriLocale,{
          year:'numeric', month:'long', day:'numeric', timeZone:ZONE
        }).format(hijriBase)}`;
    }

    function updateSky(now) {
      const parts = new Intl.DateTimeFormat('en-GB',{
        hour:'2-digit', minute:'2-digit', hour12:false, timeZone:ZONE
      }).formatToParts(now);
      const h = +parts.find(p=>p.type==='hour').value;
      const m = +parts.find(p=>p.type==='minute').value;

      const isNoon = (h >=17 && h <18);
      const isDay  = (h >=6  && h <18);
      document.body.classList.toggle('noon',  isNoon);
      document.body.classList.toggle('day',   !isNoon && isDay);
      document.body.classList.toggle('night', !isNoon && !isDay);

      // background-image swap
      if (isNoon) {
        document.body.style.backgroundImage = 'none';
      } else {
        document.body.style.backgroundImage = isDay
          ? "url('/static/images/day.jpg')"
          : "url('/static/images/night.jpg')";
      }

      // DUSK fade from 17→18
      let duskOpacity = 0;
      if (h >=17 && h <18) {
        duskOpacity = (h + m/60 - 17);
      }
      duskEl.style.opacity = duskOpacity;

      // sun/moon arc progress
      let p = (isNoon||isDay)
        ? ((h + m/60) - 6) / 12
        : (((h<6?h+24:h) + m/60) - 18) / 12;
      p = Math.max(0, Math.min(1, p));

      const el    = (isNoon||isDay) ? sunEl  : moonEl;
      const other = (isNoon||isDay) ? moonEl : sunEl;
      other.style.display = 'none';
      el.style.display    = 'block';

      let x, top;
      if (p <= 0.5) {
        const t = p/0.5;
        x   = lerp(A.x, B.x, t);
        top = lerp(A.top, B.top, t);
      } else {
        const t = (p-0.5)/0.5;
        x   = lerp(B.x, C.x, t);
        top = lerp(B.top, C.top, t);
      }
      el.style.left = x + '%';
      el.style.top  = top + '%';
    }

    function tick() {
      const now = new Date();
      updateClock(now);
      updateSky(now);
    }
    buildTicks();
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
