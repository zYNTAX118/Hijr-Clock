<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Jakarta Time & Hijri Calendar</title>
  <style>
    /* RESET & LAYOUT */
    * { box-sizing:border-box; margin:0; padding:0 }
    html,body { height:100% }
    body {
      position:relative;
      overflow-x:hidden;
      overflow-y:auto;
      font-family:sans-serif;
      display:flex; align-items:center; justify-content:center;
      transition: background 1s ease-in-out;
      background-size:cover; background-position:center;
      background-image:url('/static/images/day.jpg');
      padding:clamp(1rem, 3vw, 2rem);
      padding-bottom:calc(clamp(1rem,4vh,3.5rem) + env(safe-area-inset-bottom, 0));
      min-height:100vh;
    }

    /* SKY LAYERS */
    .layer {
      position:absolute; inset:0;
      background-repeat:repeat;
      opacity:0; pointer-events:none;
      transition:opacity 1s ease-in-out;
    }
    #stars  { background-image:url('/static/images/stars.png'); animation:star-drift 200s linear infinite; z-index:3 }
    #noon   { background:linear-gradient(to bottom,#FF9E2C,#FFD76D); z-index:1 }
    #dusk   { background:linear-gradient(to bottom,rgba(255,94,0,0.2),rgba(128,0,128,0.2)); z-index:2 }
    #clouds {
      background-image:url('/static/images/clouds.png');
      animation:cloud-drift 60s linear infinite;
      z-index:5;
      top:0; bottom:auto; height:45%;
    }

    /* SUN & MOON */
    .celestial {
      position:absolute; width:120px; height:120px;
      background-size:contain; background-repeat:no-repeat;
      display:none; pointer-events:none; z-index:4;
    }
    #sun  { background-image:url('/static/images/sun.png') }
    #moon { background-image:url('/static/images/moon.png') }

    /* LAYER VISIBILITY */
    body.noon   #noon   { opacity:1 }
    body.day    #noon   { opacity:0 }
    body.night  #noon   { opacity:0 }

    body.noon   #dusk   { /* JS‐controlled */ }
    body.day    #dusk   { /* JS‐controlled */ }
    body.night  #dusk   { opacity:0 }

    body.noon   #stars  { opacity:0.3 }
    body.day    #stars  { opacity:0 }
    body.night  #stars  { opacity:1 }

    body.noon   #clouds { opacity:0.7 }
    body.day    #clouds { opacity:0.7 }
    body.night  #clouds { opacity:0.7 }

    /* Celestial show/hide */
    body.day    #sun,    body.noon #sun   { display:block }
    body.day    #moon,   body.noon #moon  { display:none }
    body.night  #sun                    { display:none }
    body.night  #moon                   { display:block }

    /* CLOCK */
    .clock-wrapper {
      position:relative;
      z-index:6;
      width:min(80vmin, 520px);
      aspect-ratio:1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .clock-face {
      position:relative;
      width:100%;
      height:100%;
      border-radius:50%;
      background:radial-gradient(circle at 50% 40%, #2c2f33 0%, #1c1f23 55%, #17181b 100%);
      box-shadow:0 20px 40px rgba(0,0,0,0.45);
    }
    .outer-glow {
      position:absolute;
      inset:-3%;
      border-radius:50%;
      box-shadow:0 0 30px rgba(255,196,0,0.6);
      border:6px solid rgba(255,196,0,0.6);
    }
    .outer-ring {
      position:absolute;
      inset:2%;
      border-radius:50%;
      border:6px solid #d9b20d;
      box-shadow:inset 0 0 8px rgba(255,255,255,0.15);
    }
    .inner-ring {
      position:absolute;
      inset:25%;
      border-radius:50%;
      border:7px solid rgba(110,196,255,0.9);
      box-shadow:0 0 0 8px rgba(0,0,0,0.4) inset;
    }
    .clock-ticks {
      position:absolute;
      inset:0;
    }
    .clock-ticks .tick {
      position:absolute;
      top:50%;
      left:50%;
      width:2px;
      height:10px;
      background:rgba(255,255,255,0.85);
      transform:rotate(var(--tick-rotate)) translateY(var(--tick-radius));
      transform-origin:center center;
      border-radius:2px;
    }
    .clock-ticks .tick.major {
      height:18px;
      width:3px;
      background:#fff;
    }
    .clock-ticks.outer .tick { --tick-radius:-46%; }
    .clock-ticks.inner .tick {
      --tick-radius:-33%;
      background:rgba(200,200,200,0.65);
    }
    .clock-ticks.inner .tick.major {
      height:14px;
      width:2px;
      background:rgba(200,200,200,0.9);
    }
    .clock-numbers {
      position:absolute;
      inset:0;
      font-size:clamp(1.4rem, 4.5vmin, 2.6rem);
      color:#f5f5f5;
      font-weight:600;
      text-shadow:0 2px 4px rgba(0,0,0,0.5);
    }
    .clock-numbers .number {
      position:absolute;
      top:50%;
      left:50%;
      transform:rotate(var(--number-rotate)) translateY(-44%) rotate(calc(-1 * var(--number-rotate)));
      transform-origin:center center;
    }
    .hand {
      position:absolute;
      top:50%;
      left:50%;
      transform-origin:50% 100%;
      border-radius:50px;
    }
    .hand.gregorian {
      background:#f0c000;
      box-shadow:0 0 8px rgba(255,204,0,0.6);
    }
    .hand.hijri {
      background:#7fd2ff;
      box-shadow:0 0 6px rgba(130,210,255,0.5);
    }
    .hand.hour {
      width:10px;
      height:22%;
      margin-top:-22%;
    }
    .hand.minute {
      width:8px;
      height:32%;
      margin-top:-32%;
    }
    .hand.second {
      width:3px;
      height:38%;
      margin-top:-38%;
      opacity:0.8;
    }
    .hand.hijri.hour {
      width:8px;
      height:15%;
      margin-top:-15%;
    }
    .hand.hijri.minute {
      width:6px;
      height:22%;
      margin-top:-22%;
    }
    .hand.hijri.second {
      width:2px;
      height:26%;
      margin-top:-26%;
      opacity:0.7;
    }
    .center-cap {
      position:absolute;
      width:28px;
      height:28px;
      border-radius:50%;
      background:radial-gradient(circle, #ffe08a 0%, #d9a300 65%, #b58500 100%);
      top:50%;
      left:50%;
      transform:translate(-50%, -50%);
      box-shadow:0 0 12px rgba(255,210,90,0.7);
      z-index:5;
    }
    .clock-labels {
      position:absolute;
      inset:auto 0 14%;
      text-align:center;
      color:#f2f2f2;
      font-size:clamp(0.75rem, 2.2vmin, 1rem);
      display:flex;
      flex-direction:column;
      gap:0.3rem;
      letter-spacing:0.04em;
      text-transform:uppercase;
    }
    .clock-labels span {
      display:block;
      color:rgba(255,255,255,0.75);
      font-size:0.75em;
    }

    /* KEYFRAMES */
    @keyframes star-drift  { 0%{background-position:0 0} 100%{background-position:-1000px 0} }
    @keyframes cloud-drift { 0%{background-position:0 0} 100%{background-position:-800px 0} }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      body {
        padding:1rem;
      }
      .clock-wrapper {
        width:min(90vmin, 420px);
      }
      .clock-labels {
        inset:auto 0 12%;
      }
    }
  </style>
</head>
<body>
  <!-- SKY LAYERS -->
  <div id="stars"  class="layer"></div>
  <div id="noon"   class="layer"></div>
  <div id="dusk"   class="layer"></div>
  <div id="clouds" class="layer"></div>

  <!-- SUN & MOON -->
  <div id="sun"   class="celestial"></div>
  <div id="moon"  class="celestial"></div>

  <!-- CLOCK -->
  <div class="clock-wrapper">
    <div class="clock-face">
      <div class="outer-glow"></div>
      <div class="outer-ring"></div>
      <div id="outer-ticks" class="clock-ticks outer"></div>
      <div id="clock-numbers" class="clock-numbers"></div>

      <div class="inner-ring"></div>
      <div id="inner-ticks" class="clock-ticks inner"></div>

      <div id="g-hour" class="hand gregorian hour"></div>
      <div id="g-minute" class="hand gregorian minute"></div>
      <div id="g-second" class="hand gregorian second"></div>

      <div id="h-hour" class="hand hijri hour"></div>
      <div id="h-minute" class="hand hijri minute"></div>
      <div id="h-second" class="hand hijri second"></div>

      <div class="center-cap"></div>
      <div class="clock-labels">
        <div id="gregorian-date">--/--/----</div>
        <div id="hijri-date">-------</div>
        <span>Hijri day starts 5:59 PM</span>
      </div>
    </div>
  </div>

  <script>
    const ZONE   = 'Asia/Jakarta';
    const sunEl  = document.getElementById('sun');
    const moonEl = document.getElementById('moon');
    const duskEl = document.getElementById('dusk');

    // Arc control points flipped: sunrise on right, sunset on left
    const A = { x:75, top:14 }, B = { x:86, top:4 }, C = { x:97, top:14 };
    const lerp = (a,b,t) => a + (b-a)*t;

    // Hijri always in English + Umm al-Qura
    const hijriLocale = 'en-GB-u-ca-islamic-umalqura';

    const ticks = { outer:60, inner:60 };

    function buildTicks() {
      const outer = document.getElementById('outer-ticks');
      const inner = document.getElementById('inner-ticks');
      [outer, inner].forEach((el, index) => {
        for (let i = 0; i < ticks.outer; i += 1) {
          const tick = document.createElement('div');
          tick.className = 'tick' + (i % 5 === 0 ? ' major' : '');
          tick.style.setProperty('--tick-rotate', `${i * 6}deg`);
          el.appendChild(tick);
        }
      });
    }

    function buildNumbers() {
      const numbers = document.getElementById('clock-numbers');
      for (let i = 1; i <= 12; i += 1) {
        const number = document.createElement('div');
        number.className = 'number';
        number.textContent = i;
        number.style.setProperty('--number-rotate', `${i * 30}deg`);
        numbers.appendChild(number);
      }
    }

    function updateClock(now) {
      // Gregorian time
      const dateOpts = { year:'numeric', month:'2-digit', day:'2-digit', timeZone:ZONE };
      const timeOpts = { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:ZONE };
      const parts = new Intl.DateTimeFormat('en-GB', timeOpts).formatToParts(now);
      const gHour = +parts.find(p=>p.type==='hour').value;
      const gMinute = +parts.find(p=>p.type==='minute').value;
      const gSecond = +parts.find(p=>p.type==='second').value;

      const gHourAngle = ((gHour % 12) + gMinute / 60) * 30;
      const gMinuteAngle = (gMinute + gSecond / 60) * 6;
      const gSecondAngle = gSecond * 6;

      document.getElementById('g-hour').style.transform =
        `translate(-50%, -100%) rotate(${gHourAngle}deg)`;
      document.getElementById('g-minute').style.transform =
        `translate(-50%, -100%) rotate(${gMinuteAngle}deg)`;
      document.getElementById('g-second').style.transform =
        `translate(-50%, -100%) rotate(${gSecondAngle}deg)`;

      // Hijri time parts with 5:59 PM rollover
      const hijriOffsetMinutes = 17 * 60 + 59;
      const totalMinutes = gHour * 60 + gMinute;
      const hijriTotalMinutes = (totalMinutes - hijriOffsetMinutes + 24 * 60) % (24 * 60);
      const hijriHour = Math.floor(hijriTotalMinutes / 60);
      const hijriMinute = hijriTotalMinutes % 60;
      const hijriSecond = gSecond;

      const hHourAngle = ((hijriHour % 12) + hijriMinute / 60) * 30;
      const hMinuteAngle = (hijriMinute + hijriSecond / 60) * 6;
      const hSecondAngle = hijriSecond * 6;

      document.getElementById('h-hour').style.transform =
        `translate(-50%, -100%) rotate(${hHourAngle}deg)`;
      document.getElementById('h-minute').style.transform =
        `translate(-50%, -100%) rotate(${hMinuteAngle}deg)`;
      document.getElementById('h-second').style.transform =
        `translate(-50%, -100%) rotate(${hSecondAngle}deg)`;

      const hijriBase = totalMinutes >= hijriOffsetMinutes
        ? now
        : new Date(now.getTime() - 86400e3);

      document.getElementById('gregorian-date').textContent =
        new Intl.DateTimeFormat('en-GB', dateOpts).format(now);
      document.getElementById('hijri-date').textContent =
        new Intl.DateTimeFormat(hijriLocale,{
          year:'numeric', month:'long', day:'numeric', timeZone:ZONE
        }).format(hijriBase);
    }

    function updateSky(now) {
      const parts = new Intl.DateTimeFormat('en-GB',{
        hour:'2-digit', minute:'2-digit', hour12:false, timeZone:ZONE
      }).formatToParts(now);
      const h = +parts.find(p=>p.type==='hour').value;
      const m = +parts.find(p=>p.type==='minute').value;

      const isNoon = (h >=17 && h <18);
      const isDay  = (h >=6  && h <18);
      document.body.classList.toggle('noon',  isNoon);
      document.body.classList.toggle('day',   !isNoon && isDay);
      document.body.classList.toggle('night', !isNoon && !isDay);

      // background-image swap
      if (isNoon) {
        document.body.style.backgroundImage = 'none';
      } else {
        document.body.style.backgroundImage = isDay
          ? "url('/static/images/day.jpg')"
          : "url('/static/images/night.jpg')";
      }

      // DUSK fade from 17→18
      let duskOpacity = 0;
      if (h >=17 && h <18) {
        duskOpacity = (h + m/60 - 17);
      }
      duskEl.style.opacity = duskOpacity;

      // sun/moon arc progress
      let p = (isNoon||isDay)
        ? ((h + m/60) - 6) / 12
        : (((h<6?h+24:h) + m/60) - 18) / 12;
      p = Math.max(0, Math.min(1, p));

      const el    = (isNoon||isDay) ? sunEl  : moonEl;
      const other = (isNoon||isDay) ? moonEl : sunEl;
      other.style.display = 'none';
      el.style.display    = 'block';

      let x, top;
      if (p <= 0.5) {
        const t = p/0.5;
        x   = lerp(A.x, B.x, t);
        top = lerp(A.top, B.top, t);
      } else {
        const t = (p-0.5)/0.5;
        x   = lerp(B.x, C.x, t);
        top = lerp(B.top, C.top, t);
      }
      el.style.left = x + '%';
      el.style.top  = top + '%';
    }

    function tick() {
      const now = new Date();
      updateClock(now);
      updateSky(now);
    }
    buildTicks();
    buildNumbers();
    tick();
    setInterval(tick, 1000);
  </script>
</body>
</html>
